<!DOCTYPE html>
<html>
<head>
<title>SVG Experiment</title>
	<meta charset="UTF-8">
</head>

<body>
  <div id="svg54583"></div>
  <script>
  {
    var items = 11;
    var taken = 0;
		var colors = ["red","orange","yellow","green","blue","purple"];
    var rows = colors.length;
    var selected = new Array(rows);
    selected.fill(0);

    var f = (function () {

      // create the svg element
      var svg_box = document.createElementNS("http://www.w3.org/2000/svg", "svg");

      // set width and height
      svg_box.setAttribute("width", "600");
      svg_box.setAttribute("height", "500");

      for (var h = 0; h < rows; h++) {
        for (var i = 0; i < items; i++) {

          // create a circle
          var my_circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          my_circle.setAttribute("cx", ""+(50+(50*i)));
          my_circle.setAttribute("cy", ""+(50+(50*h)));
					if (i == 0) {
						my_circle.setAttribute("r", "10");
						my_circle.setAttribute("fill", colors[h]);
					} else {
						my_circle.setAttribute("r", "25");
						my_circle.setAttribute("fill", "white");
					}
          my_circle.setAttribute("stroke", "black");
          my_circle.setAttribute("id", "dot"+h+"."+i);

          my_circle.setAttribute("onclick", "doClick("+h+","+i+")");

          // attach it to the container
          svg_box.appendChild(my_circle);
        }

				var my_rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
				// my_rect.setAttribute("x", ""+(50+(50*h)));
        my_rect.setAttribute("x", "50");
				my_rect.setAttribute("y", "350");
				// my_rect.setAttribute("width", "50");
        my_rect.setAttribute("width", "0");
				my_rect.setAttribute("height", "100");
				my_rect.setAttribute("stroke", "black");
				my_rect.setAttribute("id", "box"+h);
        my_rect.setAttribute("fill", colors[h]);

				svg_box.appendChild(my_rect);
      }

      // attach container to document
      document.getElementById("svg54583").appendChild(svg_box);
    });

    f();

    function doClick(row, item) {

      console.log("row:"+row+" item:item");
      console.log("taken:"+taken);

      var capacity = items - taken;

      console.log("capacity:"+capacity);
      console.log("selected:"+selected[row]);

      // If the item clicked is more than the capacity, nothing happens.
      if (item >= (capacity+selected[row])) {
        //Beh
        console.log("No action");

      } else {
        //Update the selection.
        selected[row] = item;

        //Figure out how many are taken
        taken = 0;
        for (var h = 0; h < rows; h++) {
          taken += selected[h];
        }
        console.log("new taken:"+taken);

      }
      capacity = items - taken;

      console.log("New capacity:"+capacity);

			barWidth = 50;
      for (var h = 0; h < rows; h++) {

        for (var i = 0; i < items; i++) {

          var idString = 'dot'+h+"."+i;
          var mydot = document.getElementById(idString);

          var styleString = 'white';
					if (i == 0) {
						var styleString = colors[h];
					} else if (i <= selected[h]) {
            var styleString = 'cyan';
          } else if (i >= selected[h] + capacity) {
            var styleString = 'gray';
          }
          mydot.style.fill = styleString;
        }

				var idString = 'box'+h;
				var mybox = document.getElementById(idString);
				mybox.style.x = barWidth;
				mybox.style.width = selected[h]*40;

				barWidth += selected[h]*40;
      }
    }
  }

  </script>
</body>
</html>
